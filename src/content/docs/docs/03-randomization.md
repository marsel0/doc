---
title: "Рандомизация"
--- 

## 1. Авторизация через API

- У каждого магазина есть **уникальный API-ключ**, который используется для авторизации при запросах к API.
    
- Без корректного API-ключа система не примет запрос — убедитесь, что вы передаёте актуальный ключ магазина в каждом вызове API.
    

## 2. Защита от дублирующих ордеров

- Если на один и тот же магазин создаются **два ордера с одинаковыми суммами**, система автоматически отменяет второй ордер, расценивая его как дубль.
    
- Чтобы избежать таких ситуаций, реализована **система рандомизации сумм**, позволяющая изменять итоговую сумму заказа в заданных пределах.
    

## 3. Зачем нужна рандомизация

В каждый момент времени для одного реквизита может существовать **только одна активная заявка на конкретную сумму**.  
Так как большинство ордеров создаются на популярные суммы (например, 1000 ₽), используются рандомизированные суммы, чтобы расширить пул возможных реквизитов и минимизировать конфликты.

---

## 4. Настройки рандомизации

В настройках магазина задаются следующие параметры:

- **Диапазон рандомизации (мин/макс спред):** определяет, насколько сумма может отклоняться от исходного значения.
    
- **Шаг изменения суммы:** определяет, с каким интервалом изменяется сумма (например, ±1 рубль).
    
- **Пределы рандомизации (мин/макс сумма):** границы, в которых разрешено изменять суммы.
    
    - Например: от **100 ₽** до **10 000 ₽**.
        
    - Если сумма заказа выходит за эти пределы (например, 95 ₽ или 10 001 ₽), то рандомизация не применяется.
        

> Все указанные крайние значения — включительно.

---

## 5. Алгоритм работы

1. Клиент оформляет заказ на фиксированную сумму, например, **1000 ₽**.
    
2. Система проверяет настройки и начинает подбирать ближайшее свободное значение, изменяя сумму с заданным шагом:
    
    - Сначала **1000 + шаг**
        
    - Затем **1000 - шаг**
        
    - Далее **1000 + шаг × 2**
        
    - И так далее, пока не будет найдено подходящее значение в допустимом диапазоне.
        
3. Если на большую сумму недостаточно баланса, система создаёт ордер на **меньшую возможную сумму**.
    
4. **Все комиссии и расчёты** ведутся от **фактической суммы ордера**, а не от изначальной суммы заказа клиента.