---
title: "Уникализация"
---

## Общая информация

**Уникализация сумм** — это механизм автоматического изменения суммы ордера в заданных пределах для предотвращения конфликтов при обработке платежей. В один момент времени на одном реквизите может существовать только **одна активная заявка на конкретную сумму**. Так как большинство клиентов создают ордера на одинаковые суммы (например, 1000 ₽), уникализация позволяет расширить пул доступных реквизитов и увеличить количество успешно обработанных ордеров.

Система самостоятельно подбирает ближайшую доступную сумму без участия пользователя.


## Подключение уникализации

Чтобы подключить уникализацию, напишите в поддержку сообщение (числовые значения замените на удобные для вас):

```
Подключите уникализацию с настройками:
Диапазон для уникализации: от 100 до 50000
Крайние значения уникализации: от 10 до 100
Шаг уникализации: 10
```

> **Важно:** крайние значения уникализации и шаг уникализации можно указывать как в **фиатной валюте**, так и в **процентах**.


## Важные особенности работы

При создании ордера необходимо учитывать, что итоговая сумма может быть **изменена системой уникализации**.

### Пример

Запрос на создание ордера с исходной суммой `1000`:

```json
{
  "amount": 1000,
  "currency": "RUB",
  "customer": {
    "id": "{{customerId}}"
  },
  "payment": {
    "type": "sbp",
    "bank": ""
  }
}
```

После применения уникализации система вернёт ответ с новой суммой `amount`, а также укажет исходную сумму в поле `initialAmount`:

```json
{
  "id": "0b98eb1a-9e3a-4536-bed6-d10e5a7e097a",
  "initialAmount": 1000,
  "amount": 1010,
  "currency": "RUB",
  "status": "customer_confirm",
  "statusDetails": null,
  "statusTimeoutAt": "2025-06-25T14:36:00.382Z",
  "requisites": {
    ...
  }
}
```

Клиенту необходимо сообщить **фактическую сумму к оплате — 1010 ₽**.


## Подробное описание работы уникализации

### Диапазон для уникализации

Передаются минимальная и максимальная суммы, при которых применяется уникализация.

**Пример:** от 100 до 10 000.

* Если ордер создан на сумму 99 или 10 001 — уникализация **не применяется**.

### Крайние значения уникализации

Определяют минимальное и максимальное возможное отклонение от исходной суммы.

**Пример:**

* Исходная сумма: 1000 ₽
* Отклонение: 10 ₽
* Возможные суммы: от 990 ₽ до 1010 ₽

### Шаг уникализации

Значение, на которое изменяется сумма при каждой итерации подбора.

**Пример:**

* Шаг = 1
* Система последовательно проверяет суммы: 1001, 999, 1002, 998 и т.д.



## Алгоритм работы

1. Клиент выбирает пополнение на сумму **1000 ₽**.
2. Система проверяет возможность создать ордер на эту сумму.
3. Если сумма занята, начинается подбор с учётом шага уникализации:

   * 1000 + шаг
   * 1000 − шаг
   * 1000 + шаг × 2
   * 1000 − шаг × 2
4. Подбор продолжается до тех пор, пока:

   * не будет найдена свободная сумма в допустимом диапазоне;
   * либо не будут исчерпаны все допустимые варианты.
5. Если свободных реквизитов нет — клиент получает ошибку.


## Как это выглядит для клиента

* Клиент выбирает сумму пополнения (например, 1000 ₽).
* Система автоматически подбирает ближайшую доступную сумму.
* Клиент:

  * либо получает новую сумму к оплате в допустимых пределах;
  * либо получает сообщение об отсутствии свободных реквизитов.


## Дополнительно

* Все комиссии и расчёты выполняются **от фактической суммы ордера**, а не от исходной суммы, указанной клиентом.
* Все крайние значения диапазонов считаются **включительно**.
