---
title: "Инструкция по интеграции с платформой"
---

## Личный кабинет и начало интеграции

Для интеграции с платформой обратитесь в саппорт-аккаунт для получения приглашения. По завершению регистрации рекомендуется подключить двухфакторную авторизацию (2FA). Сразу после этого вы можете самостоятельно или по запросу в саппорт-аккаунт создать магазин. Магазин является основной сущностью для работы с заказами. Нажав на созданный магазин, вы сможете увидеть API-ключи для работы с ним.

## API-ключи

У магазина есть 3 ключа:

* **API-ключ** — используется для работы с заказами.
* **Ключ подписи запросов** — нужен для проверки получаемых вебхуков.
* **API-ключ для работы с балансами** — для получения баланса, создания и обработки запросов средств.

### API-ключ и API-ключ для работы с балансами

API-ключ и ключ для работы с балансами передаются в заголовке запроса:

```
Authorization: Bearer <token>
```

В случае указания неправильного ключа или отсутствия заголовка вы получите ошибку:

```json
{
  "statusCode": 401,
  "message": "Unauthorized"
}
```

Для дополнительной защиты можно указать IP-адреса, с которых разрешены запросы к магазину. Запросы с других IP, даже с верным ключом, будут отклоняться.

### Ключ подписи запросов и вебхуки

Ключ подписи запросов используется для работы с колбеками/вебхуками, а именно для генерации сигнатуры, необходимой для проверки подлинности.

Все параметры передаются в URL вебхука. Тело запроса пустое.

Примеры передаваемых параметров:

* **После изменения статуса заказа на "completed"**:

```
id=12345678&amount=1000&customerId=12345678&status=completed&externalOrderId=12345678&signature=12345678
```

* **После изменения статуса заказа на "cancelled"**:

```
id=12345678&amount=1000&customerId=12345678&status=cancelled&externalOrderId=12345678&statusDetails=shop&signature=12345678
```

* **После изменения статуса заказа на "dispute"**:

```
id=12345678&amount=1000&customerId=12345678&status=dispute&externalOrderId=12345678&statusDetails=no_payment&signature=12345678
```

### Работа сигнатуры

Сигнатура (`signature`) формируется как SHA1-хэш от всех значений в запросе, **кроме самой сигнатуры**, плюс `signatureKey`. Все ключи сортируются в алфавитном порядке и объединяются символом `|`. Значения `null` игнорируются.

`signatureKey` можно найти в деталях магазина.

Пример на JavaScript:

```javascript
const payload = {
  id: order.id,
  status: order.status,
  amount: order.amount,
  statusDetails: order.statusDetails,
  customerId: order.customer.id,
  externalOrderId: order.integration.externalOrderId,
};

const sortedSignatureKeys = sortBy([...keys(payload), 'signatureKey']);
const stringToSign = map(sortedSignatureKeys, (key) => {
  const value = key === 'signatureKey' ? order.signatureKey : payload[key];
  return `${key}=${value}`;
}).join('|');

const signature = sha1(stringToSign);
```

## Виды интеграции и API

Система поддерживает несколько видов интеграции и API:

### Виды интеграции

* **Редирект-интеграция** — клиент перенаправляется на наш платежный шлюз и затем возвращается (при необходимости) на ваш сайт после оплаты. Самый простой вид интеграции.
* **Host to host (H2H) интеграция** — интеграция с помощью API, где клиент осуществляет оплату полностью на вашем сайте, а вся информация обновляется через запросы и callback-ы API.

### Типы API

Редирект-интеграцию можно осуществить с помощью двух типов API:

* **API магазина (Shop API)** — API “от лица” магазина.
* **API клиента (Customer API)** — API “от лица” клиента со своими ограничениями.

В общем случае, если необходима H2H интеграция, рекомендуется начинать с Shop API, а потом рассматривать Customer API при необходимости.

#### Сравнение Shop API и Customer API

**Shop API:**

* Аутентификация с постоянным ключом
* Может использоваться для создания заказов
* Доступ к любому заказу в любое время
* Требуется backend-прокси, чтобы не передавать API-ключ клиенту
* Ответ API включает все свойства, связанные с заказом
* Мерчант отвечает за свойства, доступные клиенту

**Customer API:**

* Аутентификация с временным токеном, действительным 30 минут
* Нельзя использовать для создания заказов
* Доступ к заказу в течение 24 часов после завершения
* Нет доступа к другим заказам
* Может использоваться через прокси или на пользовательском интерфейсе (после настройки администратором приложения)
* Дополнительных свойств в ответе API нет

### Основные P2P-флоу перевода денежных средств

* **PayIn** — клиент переводит денежные средства на ваш сайт
* **PayOut** — клиент выводит денежные средства с вашего сайта

